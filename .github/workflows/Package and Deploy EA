      - name: Package EA
        run: |
          python scripts/package_mt5.py

      - name: Ensure expected MQL5 structure
        run: |
          if (-Not (Test-Path "dist\mt5\MQL5")) {
            Write-Error "Expected path dist\mt5\MQL5 does not exist. Packaging failed."
          }

          # Base folders (ensured so they appear in the zip)
          New-Item -ItemType Directory -Force -Path "dist\mt5\MQL5\Experts"           | Out-Null
          New-Item -ItemType Directory -Force -Path "dist\mt5\MQL5\Include"           | Out-Null
          New-Item -ItemType Directory -Force -Path "dist\mt5\MQL5\Files"             | Out-Null
          New-Item -ItemType Directory -Force -Path "dist\mt5\MQL5\Files\configs"     | Out-Null
          New-Item -ItemType Directory -Force -Path "dist\mt5\MQL5\Files\dashboards"  | Out-Null

          # Optional folders â€“ force creation so they are visible in the zip
          New-Item -ItemType Directory -Force -Path "dist\mt5\MQL5\Indicators" | Out-Null
          New-Item -ItemType Directory -Force -Path "dist\mt5\MQL5\Scripts"    | Out-Null
          New-Item -ItemType Directory -Force -Path "dist\mt5\MQL5\Logs"       | Out-Null

          # Ensure glyphs.log + Logs have a placeholder so they appear even if empty at build time
          if (-Not (Test-Path "dist\mt5\MQL5\Files\glyphs.log")) {
            'Glyphs/log placeholder (runtime file will overwrite this).' |
              Out-File -Encoding utf8 "dist\mt5\MQL5\Files\glyphs.log"
          }
          if (-Not (Test-Path "dist\mt5\MQL5\Logs\.keep")) {
            'Runtime logs will be generated by MetaTrader here.' |
              Out-File -Encoding utf8 "dist\mt5\MQL5\Logs\.keep"
          }

      - name: Verify packaged structure
        run: |
          Write-Host "Listing dist\mt5\MQL5 recursively"
          Get-ChildItem -Path "dist\mt5\MQL5" -Recurse

      - name: Create package zip
        run: |
          if (-Not (Test-Path "dist\mt5\MQL5")) {
            Write-Error "Expected path dist\mt5\MQL5 does not exist. Packaging failed."
          }
          Compress-Archive -Path "MQL5\*" -DestinationPath "EA-Package.zip" -WorkingDirectory "dist\mt5" -Force
          Write-Host "Created EA-Package.zip with MQL5 as archive root"
