# This is the CI workflow to package your Expert Advisor for MetaTrader 5.
# It places all .mq5 and .mqh files into the Experts/AdaptiveBreakoutAI/ folder
# to match your code's #include "..." statements.

name: Package Expert Advisor for MT5

on:
  # Run automatically when you push to the main branch
  push:
    branches: [ main ]
    paths:
      - 'eas/**' # Only run if files in the 'eas' folder change

  # Allows you to run this workflow manually from the "Actions" tab in GitHub
  workflow_dispatch:

jobs:
  build-package:
    name: Build EA Package
    runs-on: ubuntu-latest
    steps:
      # Step 1: Get the latest code from your repository
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Step 2: Create the folder structure MT5 expects inside a temporary 'staging' directory
      - name: Create MT5 Staging Directory
        run: mkdir -p staging/MQL5/Experts/AdaptiveBreakoutAI
        shell: bash

      # Step 3: Copy all your source files (.mq5 and .mqh) into the staging directory
      # This uses the confirmed correct path from your repository.
      - name: Copy Source Files to Staging
        run: cp -f eas/AdaptiveBreakoutAI/src/*.* staging/MQL5/Experts/AdaptiveBreakoutAI/
        shell: bash

      # Step 4: Create a zip file from the staging directory's contents
      - name: Create Zip Archive
        run: |
          cd staging
          zip -r ../EA-package.zip MQL5
        shell: bash

      # Step 5: Upload the final 'EA-package.zip' as a downloadable artifact
      - name: Upload EA Package Artifact
        uses: actions/upload-artifact@v4
        with:
          name: EA-package
          path: EA-package.zip
