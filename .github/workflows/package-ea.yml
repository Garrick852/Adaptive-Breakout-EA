# GitHub Actions Workflow to package the MQL5 Expert Advisor and Configs

name: 'Package MQL5 EA and Configs'

on:
  push:
    branches: [ main ]
    paths:
      - 'eas/**'      # Trigger on EA file changes
      - 'configs/**'  # Trigger on config file changes

  workflow_dispatch:

jobs:
  package:
    runs-on: ubuntu-latest

    steps:
      # 1. Checks-out your repository
      - name: 'Checkout Repository'
        uses: actions/checkout@v4

      # 2. Creates the staging directory structure that mirrors MT5
      - name: 'Create MT5 Staging Directories'
        run: |
          # --- Create directory for the Expert Advisor ---
          mkdir -p staging/MQL5/Experts/AdaptiveBreakoutAI

          # --- Create directory for the Config Files ---
          mkdir -p staging/MQL5/Files/configs/demo
          mkdir -p staging/MQL5/Files/configs/presets
          mkdir -p staging/MQL5/Files/configs/schema
        shell: bash

      # 3. Copies your files from the repo into the staging directory
      #    IMPORTANT: Adjust these paths if your repo structure is different!
      - name: 'Copy MQL5 Files to Staging'
        run: |
          # === Copy Expert Advisor Files ===
          # Copy main EA file
          cp -r eas/AdaptiveBreakoutAI/src/*.mq5 staging/MQL5/Experts/AdaptiveBreakoutAI/
          # Copy include files
          cp -r eas/AdaptiveBreakoutAI/src/*.mqh staging/MQL5/Experts/AdaptiveBreakoutAI/
          # Copy utils, if they exist
          if [ -d "eas/AdaptiveBreakoutAI/src/utils" ]; then
            cp -r eas/AdaptiveBreakoutAI/src/utils staging/MQL5/Experts/AdaptiveBreakoutAI/
          fi
          
          # === Copy Config Files ===
          # The configs in your repo are likely in a top-level `configs` folder.
          cp -r configs/demo/*.yaml staging/MQL5/Files/configs/demo/
          cp -r configs/presets/*.set staging/MQL5/Files/configs/presets/
          cp -r configs/schema/*.json staging/MQL5/Files/configs/schema/
        shell: bash

      # 4. Zips the entire MQL5 staging folder
      - name: 'Create Zip Archive'
        run: |
          cd staging
          zip -r ../MQL5-package.zip MQL5
        shell: bash

      # 5. Uploads the single zip file as an artifact
      - name: 'Upload MQL5 Package Artifact'
        uses: actions/upload-artifact@v4
        with:
          name: MQL5-package
          path: MQL5-package.zip
