# .github/workflows/package-mql5.yml
# FINAL CORRECTED WORKFLOW

name: Package Complete MQL5 Application

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  package-application:
    name: Create MQL5 Package
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create MT5 directory structure
        run: |
          mkdir -p staging/MQL5/Experts/AdaptiveBreakoutAI
          mkdir -p staging/MQL5/Include/AdaptiveBreakoutAI/utils # Add utils subdirectory
        shell: bash

      - name: Copy application files to staging area
        run: |
          # --- CORRECTED PATHS ---
          # Use the exact path provided for all EA source files
          
          # Copy .mq5 file to Experts folder
          cp -f eas/AdaptiveBreakoutAI/src/*.mq5 staging/MQL5/Experts/AdaptiveBreakoutAI/

          # Copy main .mqh files to Include folder
          cp -f eas/AdaptiveBreakoutAI/src/*.mqh staging/MQL5/Include/AdaptiveBreakoutAI/
          
          # Copy utils .mqh files to the utils sub-folder
          # Assuming you have a 'utils' subfolder like 'eas/AdaptiveBreakoutAI/src/utils/*.mqh'
          # If not, this line will do nothing, which is safe.
          cp -f eas/AdaptiveBreakoutAI/src/utils/*.mqh staging/MQL5/Include/AdaptiveBreakoutAI/utils/ 2>/dev/null || true
        shell: bash

      - name: Create Zip Archive
        run: |
          cd staging
          zip -r ../MQL5-package.zip MQL5

      - name: Upload Full MQL5 Package
        uses: actions/upload-artifact@v4
        with:
          name: MQL5-package
          path: MQL5-package.zip
