from fastapi import FastAPI, HTTPException

from dashboards.backend.models.ea_config import EAConfig
from dashboards.backend.models.router_config import RouterConfig
from dashboards.backend.services.config_service import load_and_validate
from dashboards.backend.services.router_service import get_router_config
from dashboards.backend.services.metrics_service import get_dummy_metrics

app = FastAPI(title="Adaptive Breakout EA Dashboard API")

@app.get("/health")
def health() -> dict:
    return {"status": "ok"}

@app.get("/configs/ea", response_model=EAConfig)
def get_ea_config():
    try:
        return load_and_validate(
            config_filename="ea_default.json",
            schema_filename="ea.schema.json",
            model=EAConfig,
        )
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.get("/configs/router", response_model=RouterConfig)
def router_config():
    try:
        return get_router_config()
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.get("/metrics")
def metrics():
    return get_dummy_metrics()
